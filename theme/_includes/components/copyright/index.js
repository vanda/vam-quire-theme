const path = require('path');
const { html } = require('~lib/common-tags');

/**
 * Copyright info
 * @param  {Object} eleventyConfig
 * @param  {Object} data
 *
 * @return {String}
 */
module.exports = function (eleventyConfig) {
  const { config, publication } = eleventyConfig.globalData;

  const copyrightLicensing = eleventyConfig.getFilter('copyrightLicensing');
  const licenseIcons = eleventyConfig.getFilter('licenseIcons');
  const markdownify = eleventyConfig.getFilter('markdownify');

  return function (params) {
    const { imageDir } = config.figures;

    const copyright = publication.copyright
      ? `<p>${markdownify(publication.copyright)}</p>`
      : '';

    const publisherImages = publication.publisher.flatMap(({ logo, name }) => {
      const imagePath = logo && path.join(imageDir, logo);
      return imagePath
        ? [
            `<img src="${imagePath}" class="copyright__publisher-logo" alt="${name}" />`,
          ]
        : [];
    });

    const { license } = publication;

    const printText = license.pdf_ebook_text
      ? markdownify(license.pdf_ebook_text)
      : copyrightLicensing();

    const screenText = license.online_text
      ? markdownify(license.online_text)
      : copyrightLicensing();

    return html`
      <div class="quire-copyright">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="155"
          height="91"
          fill="currentColor"
          viewBox="0 0 155 91"
        >
          <path
            d="M71.64 90.001c-6.13 0-11.253-1.739-14.815-5.029A15.529 15.529 0 0 1 53 79.502a17.718 17.718 0 0 1 2.616-17.763 25.578 25.578 0 0 1 9.257-7.127c1.678-.77 3.063-1.356 4.118-1.738 0 0-.018-.025-.046-.07a115.254 115.254 0 0 1-1.951-3.12c-3.676-6.124-4.187-13.072-1.3-17.7a13.9 13.9 0 0 1 6.243-5.353 20.123 20.123 0 0 1 18.54 1.425 10.199 10.199 0 0 1 3.048 3.068 7.882 7.882 0 0 1 1.2 4.215c0 5.07-3.85 8.373-7.08 10.252-2.828 1.646-7.05 3.867-7.091 3.89l15.83 25.133a38.641 38.641 0 0 0 3.837-7.756 36.1 36.1 0 0 0 1.941-7.413c.268-2.024.338-3.315-.945-4.179-.741-.5-1.882-.745-3.937-.853a6.028 6.028 0 0 1-.91-.11.661.661 0 0 1 .14-1.314h14.369a.598.598 0 0 1 .618.564.653.653 0 0 1-.445.727 7.678 7.678 0 0 1-1.3.186 5.057 5.057 0 0 0-3.823 1.75c-.737.87-1.241 2.966-1.574 4.354l-.02.084a47.495 47.495 0 0 1-6.907 15.617l1.178 1.87 1.387 2.2c1.572 2.48 3.958 5.434 6.4 5.434a3.058 3.058 0 0 0 3.135-1.82c.449-1.076.835-1.514 1.332-1.514.111.001.221.02.327.055a.726.726 0 0 1 .451.4 1.084 1.084 0 0 1 0 .848 9.216 9.216 0 0 1-3.771 3.86 13.652 13.652 0 0 1-6.983 1.911 16.956 16.956 0 0 1-7.21-1.465 11.743 11.743 0 0 1-4.551-3.662 29.245 29.245 0 0 1-17.483 5.613Zm-1.748-35.8a14.611 14.611 0 0 0-5.5 6.44 17.619 17.619 0 0 0-1.423 7.018 18.58 18.58 0 0 0 4.948 12.3 17.734 17.734 0 0 0 5.425 4.078 15.402 15.402 0 0 0 6.718 1.55 14.733 14.733 0 0 0 8.144-2.73c-3.64-5.67-5.186-8.093-8.922-13.946l-.011-.017c-2.09-3.273-4.95-7.756-9.33-14.612l-.022-.036-.014-.022-.017-.026.004.003Zm8.93-27.47c-2.326 0-3.907.724-4.972 2.278a7.383 7.383 0 0 0-.953 5.417c.317 1.862.934 3.66 1.825 5.325 1.773 3.383 4.884 8.266 4.915 8.315a13.654 13.654 0 0 0 5.87-11.288c.152-2.75-.629-5.47-2.215-7.722a5.828 5.828 0 0 0-4.47-2.325ZM36.85 89.756a.413.413 0 0 1-.4-.28c-.04-.119-6.528-19.882-12.8-38.994l-.51-1.552C17.427 31.528 10.318 9.872 10.008 8.92 9.7 7.985 8.525 4.856 6.32 3.79a9.892 9.892 0 0 0-4.113-.817 8.092 8.092 0 0 1-1.866-.245.574.574 0 0 1-.334-.62.66.66 0 0 1 .672-.633h33.146c.5 0 .784.091.88.573a.773.773 0 0 1-.117.623.611.611 0 0 1-.45.241c-.411.036-.608.052-1.038.082-3.23.225-4.47.78-5.1 2.28-.324.77-.14 2.162.6 4.512l10.658 33.94.04.13c2.99 9.524 5.816 18.521 5.915 18.834h.08c.186-.482 19.817-51.478 20.555-53.5.887-2.426 1.023-3.886.44-4.735-.716-1.047-1.7-1.294-4.113-1.466l-.577-.04c-.771-.054-1.436-.1-1.758-.143-.427-.058-.643-.28-.643-.66 0-.554.472-.67.867-.67l17.21.006a.641.641 0 0 1 .638.672.662.662 0 0 1-.713.657c-2.784.152-4.223.45-5.311 1.1a5.87 5.87 0 0 0-2.105 2.9c-.242.6-9.154 23.254-17.772 45.164l-.022.056a54183.49 54183.49 0 0 1-14.733 37.451.437.437 0 0 1-.407.274Zm117.367-.49h-36.472a.658.658 0 0 1-.707-.667.699.699 0 0 1 .58-.737c.34-.05.683-.087 1.147-.126a14.088 14.088 0 0 0 3.94-.77 3.177 3.177 0 0 0 1.82-2.728 10.468 10.468 0 0 0-.706-2.9l-20.422-56.843c.07-.21 7.847-23.53 8.013-24.039.093-.285.274-.456.484-.456.21 0 .386.163.489.436.2.54 30.267 79.363 30.55 80.1 2.316 6.071 6.155 6.876 9.888 7.18.707.058 1.195.11 1.349.135a.711.711 0 0 1 .648.5c.029.093.039.19.029.287a.663.663 0 0 1-.63.628Z"
          ></path>
        </svg>
        <p>Â© Victoria and Albert Museum, London, 2024</p>
      </div>
    `;
  };
};
